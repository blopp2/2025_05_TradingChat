console.log("Service Worker wurde geladen"),chrome.runtime.onMessage.addListener(((e,r,a)=>{if("captureScreenshot"===e.action)return(async()=>new Promise(((e,r)=>{chrome.tabs.captureVisibleTab(null,{format:"jpeg",quality:90},(a=>{chrome.runtime.lastError?r(new Error(chrome.runtime.lastError.message)):e(a)}))})))().then((e=>a({dataUrl:e}))).catch((e=>a({error:e.message}))),!0})),chrome.action.onClicked.addListener((async e=>{if(e?.id)try{await chrome.sidePanel.setOptions({tabId:e.id,enabled:!0,path:"src/sidebar.html"}),await chrome.sidePanel.open({tabId:e.id}),console.log("Side Panel erfolgreich geöffnet")}catch(e){console.error("Fehler beim Öffnen des Side Panels:",e)}})),chrome.tabs.onUpdated.addListener((async(e,r,a)=>{if("complete"===r.status&&a.url?.includes("tradingview.com"))try{await chrome.sidePanel.setOptions({tabId:e,enabled:!0,path:"src/sidebar.html"})}catch(e){console.error("Auto-Enable fehlgeschlagen:",e)}}));